name: Auto Semantic Versioning

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      bump:
        description: "Which part of the semantic version should be bumped?"
        required: true
        default: patch
        type: choice
        options:
          - patch
          - minor
          - major

permissions:
  contents: write

jobs:
  semver:
    name: Create semantic version tag
    runs-on: ubuntu-latest

    steps:
      - name: Checkout full history
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Determine bump level
        id: bump
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "level=${{ github.event.inputs.bump }}" >> "$GITHUB_OUTPUT"
          else
            echo "level=patch" >> "$GITHUB_OUTPUT"
          fi

      - name: Bump version and push tag
        id: tag
        uses: anothrNick/github-tag-action@1.75.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEFAULT_BUMP: patch
          BUMP: ${{ steps.bump.outputs.level }}
          WITH_V: true
          RELEASE_BRANCHES: main
          INITIAL_VERSION: 1.0.0

      - name: Publish summary
        if: ${{ steps.tag.outputs.new_tag }}
        run: |
          {
            echo "### âœ¨ Version bumped";
            echo "- Event: ${{ github.event_name }}";
            echo "- Bump type: ${{ steps.bump.outputs.level }}";
            echo "- New tag: ${{ steps.tag.outputs.new_tag }}";
          } >> "$GITHUB_STEP_SUMMARY"
